<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏≤‡∏ß - Scoreboard</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
            text-align: center;
            padding: 20px;
            margin: 0;
            overflow-x: hidden;
        }
        h1 {
            color: #cbd5e0;
            text-shadow: 2px 2px 4px #3f1c22;
            font-size: 3em;
            margin-bottom: 5px;
        }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ --- */
        .timer-box { margin: 20px 0; }
        .timer-display {
            font-size: 3em;
            background: #e94560;
            color: white;
            padding: 10px 30px;
            border-radius: 10px;
            font-weight: bold;
            display: inline-block;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.5);
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        /* üö® ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≠‡∏ô‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ üö® */
        @keyframes flashAlert {
            0%, 100% { background-color: #ff0000; transform: scale(1); box-shadow: 0 0 20px #ff0000; }
            50% { background-color: #8b0000; color: #ffd700; transform: scale(1.1); box-shadow: 0 0 50px #ff0000; }
        }
        .timer-time-up {
            animation: flashAlert 0.8s infinite;
        }

        .btn-start {
            background: #a8dadc;
            color: #1d3557;
            font-size: 1.2em;
            font-weight: bold;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .btn-start:hover { background: #457b9d; color: white; }

        /* --- ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á --- */
        #scoreboard {
            max-width: 1200px;
            margin: 0 auto;
            background: #16213e;
            padding: 40px 20px 20px 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            height: 500px;
            overflow-x: auto;
        }

        .team-col {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            height: 100%;
            width: 100px;
        }

        .score-area {
            margin-bottom: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
        }

        /* üëë ‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏á‡∏Å‡∏∏‡∏é üëë */
        @keyframes crownBounce {
            0%, 100% { transform: translateY(0) scale(1); filter: drop-shadow(0 0 5px gold); }
            50% { transform: translateY(-8px) scale(1.1); filter: drop-shadow(0 0 15px #ffeb3b); }
        }

        .crown {
            font-size: 2em;
            margin-bottom: 5px;
            min-height: 40px; 
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease;
        }

        .crown.winner { animation: crownBounce 1.5s infinite ease-in-out; opacity: 1; }
        .crown.loser { opacity: 0; animation: none; }

        .score {
            font-size: 1.8em;
            font-weight: bold;
            color: #e94560;
        }

        .bar-container {
            width: 60px;
            height: 350px;
            background: #0f3460;
            border-radius: 5px 5px 0 0;
            display: flex;
            align-items: flex-end;
        }

        .bar {
            width: 100%;
            background: linear-gradient(0deg, #d4a373 0%, #faedcd 100%);
            height: 0%;
            transition: height 1s ease-in-out;
            border-radius: 5px 5px 0 0;
            position: relative;
        }

        .team-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid #fff;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translate(-50%, -50%); 
            background: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            z-index: 2;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .team-img:hover {
            transform: translate(-50%, -50%) scale(1.2);
            z-index: 10;
        }

        .team-name {
            margin-top: 15px;
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
            height: 40px;
            color: #a8dadc;
        }

        /* --- üñºÔ∏è ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡∏° --- */
        #imageModal {
            display: none; 
            position: fixed;
            z-index: 990; 
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.85); 
            align-items: center; justify-content: center; flex-direction: column;
        }

        .modal-info {
            text-align: center; margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
            animation: zoomIn 0.3s ease;
        }

        .modal-game-name { color: #a8dadc; font-size: 1.5em; margin: 0 0 10px 0; }
        .modal-team-name { color: #ffffff; font-size: 3em; margin: 0; font-weight: bold; }
        .modal-score-box {
            background: rgba(233, 69, 96, 0.8); color: white; font-size: 2em;
            font-weight: bold; padding: 5px 20px; border-radius: 10px;
            display: inline-block; margin-top: 10px; border: 2px solid #fff;
        }
        .modal-crown {
            font-size: 4em; margin-bottom: -15px;
            animation: crownBounce 1.5s infinite ease-in-out; display: none;
        }

        .modal-content {
            max-width: 80%; max-height: 50vh; border: 5px solid white;
            border-radius: 15px; box-shadow: 0 0 30px rgba(0,0,0,0.8);
            animation: zoomIn 0.3s ease; 
        }

        .close-btn {
            color: white; font-size: 50px; font-weight: bold;
            position: absolute; top: 20px; right: 40px; cursor: pointer; z-index: 1000;
        }
        .close-btn:hover { color: #e94560; }

        @keyframes zoomIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* --- üö® ‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (Time's Up Overlay) üö® --- */
        #timeUpOverlay {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        @keyframes smashDown {
            0% { transform: translateY(-300px) scale(0.2); opacity: 0; }
            60% { transform: translateY(20px) scale(1.1); opacity: 1; }
            80% { transform: translateY(-10px) scale(0.95); }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }

        .time-up-text {
            font-size: 7em;
            color: #ff0000;
            text-transform: uppercase;
            font-weight: 900;
            text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000, 2px 2px 0px #fff;
            margin: 0;
            animation: smashDown 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) both;
        }

        .time-up-subtext {
            color: #fff;
            font-size: 2em;
            margin-top: 20px;
            animation: zoomIn 1s ease 0.5s both;
        }

        .btn-close-timeup {
            margin-top: 40px;
            background: #e94560;
            color: white;
            font-size: 1.5em;
            padding: 15px 40px;
            border: 2px solid white;
            border-radius: 50px;
            cursor: pointer;
            animation: zoomIn 1s ease 1s both;
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.5);
            transition: all 0.3s;
        }

        .btn-close-timeup:hover {
            background: #fff;
            color: #e94560;
            transform: scale(1.1);
        }

    </style>
</head>
<body>

    <h1>‚ùÑÔ∏è ‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏≤‡∏ß ‚ùÑÔ∏è</h1>
    
    <div class="timer-box">
        <div id="timerDisplay" class="timer-display">05:00</div>
        <br>
        <button id="startBtn" class="btn-start" onclick="startTimer()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤ 5 ‡∏ô‡∏≤‡∏ó‡∏µ</button>
    </div>

    <div id="scoreboard">
        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...
    </div>

    <div id="imageModal">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <div class="modal-info">
            <h2 class="modal-game-name">‚ùÑÔ∏è ‡∏¢‡∏¥‡πà‡∏á‡∏™‡∏π‡∏á‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏≤‡∏ß ‚ùÑÔ∏è</h2>
            <div id="modalCrown" class="modal-crown">üëë</div>
            <h3 id="modalTeamName" class="modal-team-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</h3>
            <div class="modal-score-box">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="modalScore">0</span></div>
        </div>
        <img id="largeImage" class="modal-content" src="" alt="Large Team Image">
    </div>

    <div id="timeUpOverlay">
        <h1 class="time-up-text">‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!</h1>
        <div class="time-up-subtext">‡∏ß‡∏≤‡∏á‡∏°‡∏∑‡∏≠‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÑ‡∏°‡πâ ‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß</div>
        <button class="btn-close-timeup" onclick="closeTimeUp()">‡∏î‡∏π‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</button>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbycGzamS_3uywpnE1-MgfPt9PwHZzo0rk--6cjpWIswQsM7hFprpDtNnjj28V07RCbP/exec'; // *** ‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ***

        async function fetchScores() {
            try {
                const response = await fetch(API_URL);
                let data = await response.json();

                const scoreboard = document.getElementById('scoreboard');
                scoreboard.innerHTML = ''; 

                const currentMaxScore = Math.max(...data.map(d => d.score));
                const heightMaxReference = Math.max(currentMaxScore, 1); 

                data.forEach((item) => {
                    const heightPercent = (item.score / heightMaxReference) * 100;
                    const isWinner = (item.score === currentMaxScore && item.score > 0);
                    const crownClass = isWinner ? 'crown winner' : 'crown loser';

                    const col = document.createElement('div');
                    col.className = 'team-col';
                    
                    col.innerHTML = `
                        <div class="score-area">
                            <div class="${crownClass}">üëë</div>
                            <div class="score">${item.score}</div>
                        </div>
                        <div class="bar-container">
                            <div class="bar" style="height: ${heightPercent}%;">
                                <img src="${item.imageUrl}" class="team-img" alt="team image" 
                                     onclick="openModal('${item.imageUrl}', '${item.team}', ${item.score}, ${isWinner})">
                            </div>
                        </div>
                        <div class="team-name">${item.team}</div>
                    `;
                    scoreboard.appendChild(col);
                });

            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // --- üñºÔ∏è ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡∏ç‡πà ---
        function openModal(imageUrl, teamName, score, isWinner) {
            const modal = document.getElementById('imageModal');
            document.getElementById('largeImage').src = imageUrl;
            document.getElementById('modalTeamName').innerText = teamName;
            document.getElementById('modalScore').innerText = score;
            
            const crown = document.getElementById('modalCrown');
            crown.style.display = isWinner ? 'block' : 'none';
            modal.style.display = 'flex'; 
        }

        function closeModal() {
            document.getElementById('imageModal').style.display = 'none'; 
        }

        // ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ß‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î‡∏£‡∏π‡∏õ‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏î‡πâ
        window.onclick = function(event) {
            const modal = document.getElementById('imageModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // --- üö® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ üö® ---
        function closeTimeUp() {
            document.getElementById('timeUpOverlay').style.display = 'none';
        }

        // --- ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå ---
        let timeInSeconds = 5 * 60; // 5 ‡∏ô‡∏≤‡∏ó‡∏µ
        // let timeInSeconds = 5; // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏Å‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö
        
        let timerInterval = null;

        function startTimer() {
            if (timerInterval) return;
            document.getElementById('startBtn').style.display = 'none';

            timerInterval = setInterval(() => {
                timeInSeconds--;
                let minutes = Math.floor(timeInSeconds / 60).toString().padStart(2, '0');
                let seconds = (timeInSeconds % 60).toString().padStart(2, '0');
                
                const timerDisplay = document.getElementById('timerDisplay');
                timerDisplay.innerText = `${minutes}:${seconds}`;

                // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 0
                if (timeInSeconds <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.innerText = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤!";
                    
                    // 1. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏≤‡∏™‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö
                    timerDisplay.classList.add('timer-time-up'); 
                    
                    // 2. ‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏õ‡∏Å‡∏£‡∏∞‡πÅ‡∏ó‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    document.getElementById('timeUpOverlay').style.display = 'flex';
                }
            }, 1000);
        }

        fetchScores();
        setInterval(fetchScores, 5000); 
    </script>
</body>
</html>